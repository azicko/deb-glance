Description: CVE-2013-0212 Backend password leak in Glance error message
 Dan Prince of Red Hat discovered an issue in Glance error reporting. By
 creating an image in Glance by URL that references a mis-configured
 Swift endpoint, or if the Swift endpoint that a previously-ACTIVE image
 references for any reason becomes unusable, an authenticated user may
 access the Glance operator's Swift credentials for that endpoint. Only
 setups that use the single-tenant Swift store are affected.
Date: Thu, 24 Jan 2013 10:45:19 +0000
Bug-Debian: http://bugs.debian.org/699270
Bug-Ubuntu: https://launchpad.net/bugs/1098962
Origin: upstream, https://review.openstack.org/#/c/20696/

diff --git a/glance/store/swift.py b/glance/store/swift.py
index 59f0f57..64ef21b 100644
--- a/glance/store/swift.py
+++ b/glance/store/swift.py
@@ -136,7 +136,7 @@ class StoreLocation(glance.store.location.StoreLocation):
                     "like so: "
                     "swift+http://user:pass@authurl.com/v1/container/obj"
                     )
-            LOG.error(_("Invalid store uri %(uri)s: %(reason)s") % locals())
+            LOG.error(_("Invalid store URI: %(reason)s") % locals())
             raise exception.BadStoreUri(message=reason)
 
         pieces = urlparse.urlparse(uri)
@@ -162,8 +162,7 @@ class StoreLocation(glance.store.location.StoreLocation):
         if creds:
             cred_parts = creds.split(':')
             if len(cred_parts) != 2:
-                reason = (_("Badly formed credentials '%(creds)s' in Swift "
-                            "URI") % locals())
+                reason = (_("Badly formed credentials in Swift URI."))
                 LOG.error(reason)
                 raise exception.BadStoreUri()
             user, key = cred_parts
@@ -181,7 +180,7 @@ class StoreLocation(glance.store.location.StoreLocation):
                 path_parts.insert(0, netloc)
                 self.auth_or_store_url = '/'.join(path_parts)
         except IndexError:
-            reason = _("Badly formed Swift URI: %s") % uri
+            reason = _("Badly formed Swift URI.")
             LOG.error(reason)
             raise exception.BadStoreUri()
 
@@ -293,8 +292,8 @@ class Store(glance.store.base.Store):
         except swiftclient.ClientException, e:
             if e.http_status == httplib.NOT_FOUND:
                 uri = location.get_store_uri()
-                raise exception.NotFound(_("Swift could not find image at "
-                                         "uri %(uri)s") % locals())
+                msg = _("Swift could not find image at URI.")
+                raise exception.NotFound(msg)
             else:
                 raise
 
@@ -543,7 +542,7 @@ class Store(glance.store.base.Store):
         except swiftclient.ClientException, e:
             if e.http_status == httplib.CONFLICT:
                 raise exception.Duplicate(_("Swift already has an image at "
-                                          "location %s") % location.get_uri())
+                                          "this location."))
             msg = (_("Failed to add object to Swift.\n"
                      "Got error from Swift: %(e)s") % locals())
             LOG.error(msg)
@@ -596,8 +595,8 @@ class Store(glance.store.base.Store):
         except swiftclient.ClientException, e:
             if e.http_status == httplib.NOT_FOUND:
                 uri = location.get_store_uri()
-                raise exception.NotFound(_("Swift could not find image at "
-                                         "uri %(uri)s") % locals())
+                msg = _("Swift could not find image at URI.")
+                raise exception.NotFound(msg)
             else:
                 raise
 
@@ -637,8 +636,8 @@ class Store(glance.store.base.Store):
             except swiftclient.ClientException, e:
                 if e.http_status == httplib.NOT_FOUND:
                     uri = location.get_store_uri()
-                    raise exception.NotFound(_("Swift could not find image at "
-                                             "uri %(uri)s") % locals())
+                    msg = _("Swift could not find image at URI.")
+                    raise exception.NotFound(msg)
                 else:
                     raise
 
-- 
1.7.9.5

