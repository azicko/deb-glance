Description: CVE-2013-0212 Backend password leak in Glance error message
 Dan Prince of Red Hat discovered an issue in Glance error reporting. By
 creating an image in Glance by URL that references a mis-configured
 Swift endpoint, or if the Swift endpoint that a previously-ACTIVE image
 references for any reason becomes unusable, an authenticated user may
 access the Glance operator's Swift credentials for that endpoint. Only
 setups that use the single-tenant Swift store are affected.
Date: Thu, 24 Jan 2013 10:45:19 +0000
Bug-Debian: http://bugs.debian.org/699270
Bug-Ubuntu: https://launchpad.net/bugs/1098962
Origin: upstream, https://review.openstack.org/#/c/20696/

--- glance-2012.1.1.orig/glance/store/swift.py
+++ glance-2012.1.1/glance/store/swift.py
@@ -109,6 +109,7 @@ class StoreLocation(glance.store.locatio
                     "like so: "
                     "swift+http://user:pass@authurl.com/v1/container/obj"
                     )
+            logger.error(_("Invalid store URI: %(reason)s") % locals())
             raise exception.BadStoreUri(uri, reason)
 
         pieces = urlparse.urlparse(uri)
@@ -138,8 +139,7 @@ class StoreLocation(glance.store.locatio
             # the account and user. Combine them into a single username of
             # account:user
             if len(cred_parts) == 1:
-                reason = (_("Badly formed credentials '%(creds)s' in Swift "
-                            "URI") % locals())
+                reason = (_("Badly formed credentials in Swift URI."))
                 raise exception.BadStoreUri(uri, reason)
             elif len(cred_parts) == 3:
                 user = ':'.join(cred_parts[0:2])
@@ -262,8 +262,8 @@ class Store(glance.store.base.Store):
         except swift_client.ClientException, e:
             if e.http_status == httplib.NOT_FOUND:
                 uri = location.get_store_uri()
-                raise exception.NotFound(_("Swift could not find image at "
-                                         "uri %(uri)s") % locals())
+                msg = _("Swift could not find image at URI.")
+                raise exception.NotFound(msg)
             else:
                 raise
 
@@ -461,7 +461,7 @@ class Store(glance.store.base.Store):
         except swift_client.ClientException, e:
             if e.http_status == httplib.CONFLICT:
                 raise exception.Duplicate(_("Swift already has an image at "
-                                          "location %s") % location.get_uri())
+                                          "this location."))
             msg = (_("Failed to add object to Swift.\n"
                    "Got error from Swift: %(e)s") % locals())
             logger.error(msg)
@@ -510,8 +510,8 @@ class Store(glance.store.base.Store):
         except swift_client.ClientException, e:
             if e.http_status == httplib.NOT_FOUND:
                 uri = location.get_store_uri()
-                raise exception.NotFound(_("Swift could not find image at "
-                                         "uri %(uri)s") % locals())
+                msg = _("Swift could not find image at URI.")
+                raise exception.NotFound(msg)
             else:
                 raise
 
